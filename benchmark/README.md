# Benchmarks

## Sample apps

All apps employ two global middlewares with `req` mutations, an empty `GET` route handler for `favicon.ico` and a GET handler for the `/users/:id`, returning a `User: {id}` string response.

## Benchmarking command

Results are taken after one run. The command used for results is the following:

```sh
node run.mjs
```

`run.mjs` is a script that launches a child process with the app and runs benchmarks against it, recursively, going to the next app in the list.

## Information

### Hardware

Xiaomi Laptop with 16GB RAM and Intel Core i7-8550U processor.

### Software

- **OS**: Manjaro Linux
- **Kernel version**: 5.6.16-1-MANJARO
- **Node.js**: 14.6.0

## Results

> Note that benchmarks aren't completely accurate and are different on every run and on every machine.

The table takes average results

| framework           | req/s | transfer/sec |
| ------------------- | ----- | ------------ |
| @tinyhttp/app (esm) | 29067 | 3.14 MB      |
| @tinyhttp/app (cjs) | 27976 | 3.02 MB      |
| express@4.17.1      | 11023 | 1.44 MB      |
| polka@0.5.2         | 38475 | 4.16 MB      |

## Detailed results

- tinyhttp (esm)

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬───────┬──────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev │ Max      │
├─────────┼──────┼──────┼───────┼──────┼─────────┼───────┼──────────┤
│ Latency │ 2 ms │ 3 ms │ 5 ms  │ 9 ms │ 3.07 ms │ 2 ms  │ 72.65 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴───────┴──────────┘
┌───────────┬─────────┬─────────┬─────────┬────────┬─────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%  │ Avg     │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ Req/Sec   │ 20111   │ 20111   │ 30863   │ 32367  │ 29067.2 │ 4530.67 │ 20108   │
├───────────┼─────────┼─────────┼─────────┼────────┼─────────┼─────────┼─────────┤
│ Bytes/Sec │ 2.17 MB │ 2.17 MB │ 3.33 MB │ 3.5 MB │ 3.14 MB │ 489 kB  │ 2.17 MB │
└───────────┴─────────┴─────────┴─────────┴────────┴─────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.

145k requests in 5.08s, 15.7 MB read
183 errors (0 timeouts)
```

- tinyhttp (cjs)

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬─────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max     │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼─────────┤
│ Latency │ 2 ms │ 3 ms │ 6 ms  │ 9 ms │ 3.26 ms │ 1.74 ms │ 58.6 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴─────────┘
┌───────────┬───────┬───────┬─────────┬─────────┬─────────┬────────┬───────┐
│ Stat      │ 1%    │ 2.5%  │ 50%     │ 97.5%   │ Avg     │ Stdev  │ Min   │
├───────────┼───────┼───────┼─────────┼─────────┼─────────┼────────┼───────┤
│ Req/Sec   │ 18527 │ 18527 │ 28991   │ 31823   │ 27976   │ 4901.6 │ 18514 │
├───────────┼───────┼───────┼─────────┼─────────┼─────────┼────────┼───────┤
│ Bytes/Sec │ 2 MB  │ 2 MB  │ 3.13 MB │ 3.44 MB │ 3.02 MB │ 530 kB │ 2 MB  │
└───────────┴───────┴───────┴─────────┴─────────┴─────────┴────────┴───────┘

Req/Bytes counts sampled once per second.

140k requests in 5.04s, 15.1 MB read
300 errors (0 timeouts)
```

- express@4.17.1

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬──────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max      │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼──────────┤
│ Latency │ 6 ms │ 7 ms │ 18 ms │ 20 ms │ 8.42 ms │ 3.48 ms │ 64.74 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴──────────┘
┌───────────┬────────┬────────┬─────────┬─────────┬─────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg     │ Stdev   │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼─────────┼────────┤
│ Req/Sec   │ 5775   │ 5775   │ 11967   │ 13615   │ 11023.6 │ 2790.04 │ 5773   │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼─────────┼────────┤
│ Bytes/Sec │ 757 kB │ 757 kB │ 1.57 MB │ 1.78 MB │ 1.44 MB │ 365 kB  │ 756 kB │
└───────────┴────────┴────────┴─────────┴─────────┴─────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

55k requests in 5.03s, 7.22 MB read
800 errors (0 timeouts)
```

- polka@0.5.2

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬──────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max      │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼──────────┤
│ Latency │ 2 ms │ 2 ms │ 3 ms  │ 7 ms │ 2.16 ms │ 1.53 ms │ 61.29 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴──────────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg     │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ Req/Sec   │ 26399   │ 26399   │ 40991   │ 42751   │ 38475.2 │ 6076.57 │ 26396   │
├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ Bytes/Sec │ 2.85 MB │ 2.85 MB │ 4.43 MB │ 4.62 MB │ 4.16 MB │ 657 kB  │ 2.85 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.

192k requests in 5.05s, 20.8 MB read
200 errors (0 timeouts)
```
