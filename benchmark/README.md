# Benchmarks

## Sample apps

All apps employ two global middlewares with `req` mutations, an empty `GET` route handler for `favicon.ico` and a GET handler for the `/users/:id`, returning a `User: {id}` string response.

## Benchmarking command

Results are taken after one run. The command used for results is the following:

```sh
node run.mjs
```

`run.mjs` is a script that launches a child process with the app and runs benchmarks against it, recursively, going to the next app in the list.

## Information

### Hardware

Xiaomi Laptop with 16GB RAM and Intel Core i7-8550U processor.

### Software

- **OS**: Manjaro Linux
- **Kernel version**: 5.7.19-2-MANJARO
- **Node.js**: 15.4.0

## Results

> **Note**: benchmarks aren't completely accurate and are different on every run and on every machine. You need to compare proportions instead of absolute values.

The table takes average results.

| framework                 | req/s | transfer/sec | latency  |
| ------------------------- | ----- | ------------ | -------- |
| @tinyhttp/app (w/o exts)  | 25203 | 3.91 MB      | 3.56 ms  |
| @tinyhttp/app (esm)       | 17439 | 2.7 MB       | 5.19 ms  |
| @tinyhttp/app (cjs)       | 17290 | 2.68 MB      | 5.26 ms  |
| express@4.17.1            | 9360  | 1.44 MB      | 10.09 ms |
| polka@0.5.2               | 27319 | 3.58 MB      | 3.22 ms  |
| koa@2.13 + @koa/router@10 | 16234 | 2.79 MB      | 5.61 ms  |

**Conclusion**: tinyhttp (without extra `req` / `res` extensions) is ~2.7x faster than Express and ~1.08x slower than Polka.

## Detailed results

- tinyhttp (without extra `req` / `res` extensions)

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤
│ Latency │ 3 ms │ 3 ms │ 6 ms  │ 8 ms │ 3.56 ms │ 1.54 ms │ 66 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Req/Sec   │ 15351   │ 15351   │ 25855   │ 30559   │ 25203.47 │ 3685.81 │ 15348   │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Bytes/Sec │ 2.38 MB │ 2.38 MB │ 4.01 MB │ 4.74 MB │ 3.91 MB  │ 572 kB  │ 2.38 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.

378k requests in 15.03s, 58.6 MB read
300 errors (0 timeouts)
```

- tinyhttp (esm)

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 3 ms │ 5 ms │ 10 ms │ 12 ms │ 5.19 ms │ 2.25 ms │ 78 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬────────┬──────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%  │ Avg      │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼─────────┼────────┼──────────┼────────┼─────────┤
│ Req/Sec   │ 9631    │ 9631    │ 17967   │ 22607  │ 17439.74 │ 3082.9 │ 9628    │
├───────────┼─────────┼─────────┼─────────┼────────┼──────────┼────────┼─────────┤
│ Bytes/Sec │ 1.49 MB │ 1.49 MB │ 2.78 MB │ 3.5 MB │ 2.7 MB   │ 478 kB │ 1.49 MB │
└───────────┴─────────┴─────────┴─────────┴────────┴──────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.

262k requests in 15.02s, 40.5 MB read
486 errors (0 timeouts)
```

- tinyhttp (cjs)

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 4 ms │ 5 ms │ 8 ms  │ 12 ms │ 5.26 ms │ 2.51 ms │ 99 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬────────┬────────┬─────────┬─────────┬─────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg     │ Stdev   │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼─────────┼────────┤
│ Req/Sec   │ 6391   │ 6391   │ 17807   │ 20159   │ 17290   │ 3077.62 │ 6390   │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼─────────┼────────┤
│ Bytes/Sec │ 991 kB │ 991 kB │ 2.76 MB │ 3.13 MB │ 2.68 MB │ 477 kB  │ 990 kB │
└───────────┴────────┴────────┴─────────┴─────────┴─────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

259k requests in 15.03s, 40.2 MB read
380 errors (0 timeouts)
```

- express@4.17.1

```
─────────┬──────┬──────┬───────┬───────┬──────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼──────────┼─────────┼───────┤
│ Latency │ 8 ms │ 9 ms │ 16 ms │ 25 ms │ 10.09 ms │ 3.13 ms │ 72 ms │
└─────────┴──────┴──────┴───────┴───────┴──────────┴─────────┴───────┘
┌───────────┬────────┬────────┬────────┬─────────┬─────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%    │ 97.5%   │ Avg     │ Stdev   │ Min    │
├───────────┼────────┼────────┼────────┼─────────┼─────────┼─────────┼────────┤
│ Req/Sec   │ 3587   │ 3587   │ 9751   │ 10535   │ 9360.21 │ 1616.56 │ 3587   │
├───────────┼────────┼────────┼────────┼─────────┼─────────┼─────────┼────────┤
│ Bytes/Sec │ 552 kB │ 552 kB │ 1.5 MB │ 1.62 MB │ 1.44 MB │ 249 kB  │ 552 kB │
└───────────┴────────┴────────┴────────┴─────────┴─────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

140k requests in 15.03s, 21.6 MB read
700 errors (0 timeouts)
```

- polka@0.5.2

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤
│ Latency │ 2 ms │ 3 ms │ 5 ms  │ 6 ms │ 3.22 ms │ 1.47 ms │ 77 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg     │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ Req/Sec   │ 16095   │ 16095   │ 27583   │ 31087   │ 27319.2 │ 3370.93 │ 16093   │
├───────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
│ Bytes/Sec │ 2.11 MB │ 2.11 MB │ 3.61 MB │ 4.07 MB │ 3.58 MB │ 442 kB  │ 2.11 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.

410k requests in 15.03s, 53.7 MB read
200 errors (0 timeouts)
```

- koa@2.13 + @koa/router@10

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 4 ms │ 5 ms │ 10 ms │ 16 ms │ 5.61 ms │ 2.67 ms │ 70 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬────────┬────────┬─────────┬────────┬──────────┬────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%  │ Avg      │ Stdev  │ Min    │
├───────────┼────────┼────────┼─────────┼────────┼──────────┼────────┼────────┤
│ Req/Sec   │ 4735   │ 4735   │ 16071   │ 22095  │ 16234.27 │ 4190.8 │ 4733   │
├───────────┼────────┼────────┼─────────┼────────┼──────────┼────────┼────────┤
│ Bytes/Sec │ 814 kB │ 814 kB │ 2.76 MB │ 3.8 MB │ 2.79 MB  │ 721 kB │ 814 kB │
└───────────┴────────┴────────┴─────────┴────────┴──────────┴────────┴────────┘

Req/Bytes counts sampled once per second.

243k requests in 15.03s, 41.9 MB read
700 errors (0 timeouts)
```
