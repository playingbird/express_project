# Benchmarks

## Sample apps

All apps employ two global middlewares with `req` mutations, an empty `GET` route handler for `favicon.ico` and a GET handler for the `/users/:id`, returning a `User: {id}` string response.

## Benchmarking command

Results are taken after one run. The command used for results is the following:

```sh
node run.mjs
```

`run.mjs` is a script that launches a child process with the app and runs benchmarks against it, recursively, going to the next app in the list.

## Information

### Hardware

Xiaomi Laptop with 16GB RAM and Intel Core i7-8550U processor.

### Software

- **OS**: Manjaro Linux
- **Kernel version**: 5.7.19-2-MANJARO
- **Node.js**: 15.4.0

## Results

> **Note**: benchmarks aren't completely accurate and are different on every run and on every machine. You need to compare proportions instead of absolute values.

The table takes average results.

| framework                  | req/s | transfer/sec | latency |
| -------------------------- | ----- | ------------ | ------- |
| @tinyhttp/app (w/o exts)   | 22120 | 3.43 MB      | 4.02 ms |
| @tinyhttp/app (esm)        | 21908 | 3.4 MB       | 4.04 ms |
| @tinyhttp/app (cjs)        | 20945 | 3.25 MB      | 4.25 ms |
| express@4.17.1             | 9899  | 1.52 MB      | 9.58 ms |
| polka@0.5.2                | 32182 | 4.22 MB      | 2.46 ms |
| koa@2.13 + @koa/router@10  | 18728 | 3.22 MB      | 4.78 ms |
| fastify@3.9.2 + middie@5.2 | 30522 | 5.25 MB      | 2.66 ms |

**Conclusion**: tinyhttp (without extra `req` / `res` extensions) is ~2.2x faster than Express and ~1.4x slower than Polka.

## Detailed results

- tinyhttp (without extra `req` / `res` extensions)

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 3 ms │ 4 ms │ 8 ms  │ 10 ms │ 4.02 ms │ 1.82 ms │ 56 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Req/Sec   │ 12543   │ 12543   │ 21791   │ 29359   │ 22120.37 │ 4391.44 │ 12540   │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Bytes/Sec │ 1.94 MB │ 1.94 MB │ 3.38 MB │ 4.55 MB │ 3.43 MB  │ 680 kB  │ 1.94 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.

243k requests in 11.04s, 37.7 MB read
294 errors (0 timeouts)
```

- tinyhttp (esm)

```
─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 3 ms │ 4 ms │ 8 ms  │ 10 ms │ 4.04 ms │ 1.97 ms │ 70 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬────────┬────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg    │ Stdev  │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼────────┼────────┼─────────┤
│ Req/Sec   │ 15103   │ 15103   │ 22831   │ 28463   │ 21908  │ 3640.4 │ 15098   │
├───────────┼─────────┼─────────┼─────────┼─────────┼────────┼────────┼─────────┤
│ Bytes/Sec │ 2.34 MB │ 2.34 MB │ 3.54 MB │ 4.42 MB │ 3.4 MB │ 565 kB │ 2.34 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴────────┴────────┴─────────┘

Req/Bytes counts sampled once per second.

241k requests in 11.02s, 37.4 MB read
500 errors (0 timeouts)
```

- tinyhttp (cjs)

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 3 ms │ 4 ms │ 7 ms  │ 10 ms │ 4.25 ms │ 1.89 ms │ 61 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Req/Sec   │ 10023   │ 10023   │ 21823   │ 24447   │ 20945.82 │ 3761.42 │ 10019   │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Bytes/Sec │ 1.55 MB │ 1.55 MB │ 3.38 MB │ 3.79 MB │ 3.25 MB  │ 583 kB  │ 1.55 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.

230k requests in 11.02s, 35.7 MB read
400 errors (0 timeouts)
```

- express@4.17.1

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 8 ms │ 8 ms │ 20 ms │ 25 ms │ 9.58 ms │ 3.51 ms │ 73 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬────────┬────────┬────────┬─────────┬─────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%    │ 97.5%   │ Avg     │ Stdev   │ Min    │
├───────────┼────────┼────────┼────────┼─────────┼─────────┼─────────┼────────┤
│ Req/Sec   │ 3827   │ 3827   │ 10399  │ 11567   │ 9899    │ 2232.36 │ 3826   │
├───────────┼────────┼────────┼────────┼─────────┼─────────┼─────────┼────────┤
│ Bytes/Sec │ 589 kB │ 589 kB │ 1.6 MB │ 1.78 MB │ 1.52 MB │ 344 kB  │ 589 kB │
└───────────┴────────┴────────┴────────┴─────────┴─────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

109k requests in 11.02s, 16.8 MB read
700 errors (0 timeouts)
```

- polka@0.5.2

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤
│ Latency │ 2 ms │ 2 ms │ 4 ms  │ 5 ms │ 2.46 ms │ 1.25 ms │ 54 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Req/Sec   │ 19743   │ 19743   │ 33407   │ 33695   │ 32182.55 │ 3939.88 │ 19732   │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Bytes/Sec │ 2.59 MB │ 2.59 MB │ 4.37 MB │ 4.41 MB │ 4.22 MB  │ 516 kB  │ 2.58 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.

354k requests in 11.01s, 46.4 MB read
200 errors (0 timeouts)
```

- koa@2.13 + @koa/router@10

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 4 ms │ 4 ms │ 8 ms  │ 12 ms │ 4.78 ms │ 2.25 ms │ 85 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬────────┬────────┬─────────┬────────┬──────────┬────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%  │ Avg      │ Stdev  │ Min    │
├───────────┼────────┼────────┼─────────┼────────┼──────────┼────────┼────────┤
│ Req/Sec   │ 9871   │ 9871   │ 19455   │ 22095  │ 18728.37 │ 3139.7 │ 9869   │
├───────────┼────────┼────────┼─────────┼────────┼──────────┼────────┼────────┤
│ Bytes/Sec │ 1.7 MB │ 1.7 MB │ 3.35 MB │ 3.8 MB │ 3.22 MB  │ 540 kB │ 1.7 MB │
└───────────┴────────┴────────┴─────────┴────────┴──────────┴────────┴────────┘

Req/Bytes counts sampled once per second.

206k requests in 11.02s, 35.4 MB read
600 errors (0 timeouts)
```

- fastify@3.9.2 + middie@5.2

```
┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤
│ Latency │ 2 ms │ 3 ms │ 4 ms  │ 6 ms │ 2.66 ms │ 1.52 ms │ 61 ms │
└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Req/Sec   │ 11823   │ 11823   │ 32591   │ 33791   │ 30522.55 │ 6052.91 │ 11818   │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Bytes/Sec │ 2.03 MB │ 2.03 MB │ 5.61 MB │ 5.81 MB │ 5.25 MB  │ 1.04 MB │ 2.03 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.

336k requests in 11.03s, 57.7 MB read
1k errors (0 timeouts)
```
