# Benchmarks

## Sample apps

All apps employ two global middlewares with `req` mutations, an empty `GET` route handler for `favicon.ico` and a GET handler for the `/users/:id`, returning a `User: {id}` string response.

## Benchmarking command

Results are taken after one run. The command used for results is the following:

```sh
node run.mjs
```

`run.mjs` is a script that launches a child process with the app and runs benchmarks against it, recursively, going to the next app in the list.

## Information

### Hardware

Xiaomi Laptop with 16GB RAM and Intel Core i7-8550U processor.

### Software

- **OS**: Manjaro Linux
- **Kernel version**: 5.7.19-2-MANJARO
- **Node.js**: 14.9.0

## Results

> **Note**: benchmarks aren't completely accurate and are different on every run and on every machine. You need to compare proportions instead of absolute values.

The table takes average results.

| framework                  | req/s | transfer/sec |
| -------------------------- | ----- | ------------ |
| @tinyhttp/app (esm)        | 9116  | 1.19MB       |
| @tinyhttp/app (cjs)        | 8783  | 1.15MB       |
| express@4.17.1             | 2811  | 433KB        |
| polka@0.5.2                | 9821  | 1.29MB       |
| koa@2.13 + @koa/router@9.4 | 7201  | 1.24MB       |

**Conclusion**: tinyhttp is ~3.2x faster than Express and and ~1.07x slower than Polka

> **Note**: with Node 14.6.0 and 5.4 kernel there were 5-30Kreq/s for all of the benchmarks and now it's much lower

## Detailed results

- tinyhttp (esm)

```
┌─────────┬──────┬──────┬───────┬───────┬──────────┬────────┬───────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg      │ Stdev  │ Max       │
├─────────┼──────┼──────┼───────┼───────┼──────────┼────────┼───────────┤
│ Latency │ 7 ms │ 9 ms │ 21 ms │ 26 ms │ 10.39 ms │ 6.5 ms │ 188.99 ms │
└─────────┴──────┴──────┴───────┴───────┴──────────┴────────┴───────────┘
┌───────────┬────────┬────────┬─────────┬─────────┬─────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg     │ Stdev   │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼─────────┼────────┤
│ Req/Sec   │ 2025   │ 2025   │ 9631    │ 11303   │ 9116.07 │ 2217.17 │ 2025   │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼─────────┼────────┤
│ Bytes/Sec │ 265 kB │ 265 kB │ 1.26 MB │ 1.48 MB │ 1.19 MB │ 290 kB  │ 265 kB │
└───────────┴────────┴────────┴─────────┴─────────┴─────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

137k requests in 15.2s, 17.9 MB read
200 errors (0 timeouts)
```

- tinyhttp (cjs)

```
┌─────────┬──────┬───────┬───────┬───────┬──────────┬─────────┬───────────┐
│ Stat    │ 2.5% │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max       │
├─────────┼──────┼───────┼───────┼───────┼──────────┼─────────┼───────────┤
│ Latency │ 7 ms │ 10 ms │ 18 ms │ 29 ms │ 10.79 ms │ 4.97 ms │ 130.97 ms │
└─────────┴──────┴───────┴───────┴───────┴──────────┴─────────┴───────────┘
┌───────────┬────────┬────────┬─────────┬─────────┬─────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg     │ Stdev   │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼─────────┼────────┤
│ Req/Sec   │ 2703   │ 2703   │ 9311    │ 10879   │ 8783.8  │ 1793.83 │ 2702   │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼─────────┼────────┤
│ Bytes/Sec │ 354 kB │ 354 kB │ 1.22 MB │ 1.43 MB │ 1.15 MB │ 235 kB  │ 354 kB │
└───────────┴────────┴────────┴─────────┴─────────┴─────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

132k requests in 15.14s, 17.3 MB read
300 errors (0 timeouts)
```

- express@4.17.1

```
┌─────────┬───────┬───────┬───────┬────────┬──────────┬──────────┬───────────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%    │ Avg      │ Stdev    │ Max       │
├─────────┼───────┼───────┼───────┼────────┼──────────┼──────────┼───────────┤
│ Latency │ 19 ms │ 28 ms │ 91 ms │ 100 ms │ 34.24 ms │ 17.75 ms │ 153.89 ms │
└─────────┴───────┴───────┴───────┴────────┴──────────┴──────────┴───────────┘
┌───────────┬────────┬────────┬────────┬────────┬─────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%    │ 97.5%  │ Avg     │ Stdev   │ Min    │
├───────────┼────────┼────────┼────────┼────────┼─────────┼─────────┼────────┤
│ Req/Sec   │ 738    │ 738    │ 3063   │ 4251   │ 2811.67 │ 1032.08 │ 738    │
├───────────┼────────┼────────┼────────┼────────┼─────────┼─────────┼────────┤
│ Bytes/Sec │ 114 kB │ 114 kB │ 472 kB │ 655 kB │ 433 kB  │ 159 kB  │ 114 kB │
└───────────┴────────┴────────┴────────┴────────┴─────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

42k requests in 15.13s, 6.49 MB read
700 errors (0 timeouts)
```

- polka@0.5.2

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max       │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────────┤
│ Latency │ 5 ms │ 8 ms │ 19 ms │ 29 ms │ 9.62 ms │ 5.28 ms │ 118.88 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────────┘
┌───────────┬────────┬────────┬─────────┬─────────┬─────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg     │ Stdev   │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼─────────┼────────┤
│ Req/Sec   │ 2749   │ 2749   │ 10095   │ 13623   │ 9821.14 │ 2534.62 │ 2748   │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼─────────┼────────┤
│ Bytes/Sec │ 360 kB │ 360 kB │ 1.32 MB │ 1.78 MB │ 1.29 MB │ 332 kB  │ 360 kB │
└───────────┴────────┴────────┴─────────┴─────────┴─────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

147k requests in 15.13s, 19.3 MB read
200 errors (0 timeouts)
```

- koa@2.13 + @koa/router@9.4

```
┌─────────┬──────┬───────┬───────┬───────┬──────────┬─────────┬───────────┐
│ Stat    │ 2.5% │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max       │
├─────────┼──────┼───────┼───────┼───────┼──────────┼─────────┼───────────┤
│ Latency │ 8 ms │ 11 ms │ 31 ms │ 41 ms │ 13.16 ms │ 6.77 ms │ 125.24 ms │
└─────────┴──────┴───────┴───────┴───────┴──────────┴─────────┴───────────┘
┌───────────┬────────┬────────┬─────────┬─────────┬─────────┬────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg     │ Stdev  │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼────────┼────────┤
│ Req/Sec   │ 1460   │ 1460   │ 7667    │ 10303   │ 7201.47 │ 2193.5 │ 1460   │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼────────┼────────┤
│ Bytes/Sec │ 251 kB │ 251 kB │ 1.32 MB │ 1.77 MB │ 1.24 MB │ 377 kB │ 251 kB │
└───────────┴────────┴────────┴─────────┴─────────┴─────────┴────────┴────────┘

Req/Bytes counts sampled once per second.

108k requests in 15.11s, 18.6 MB read
691 errors (0 timeouts)
```
