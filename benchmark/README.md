# Benchmarks

## Sample apps

All apps employ two global middlewares with `req` mutations, an empty `GET` route handler for `favicon.ico` and a GET handler for the `/users/:id`, returning a `User: {id}` string response.

## Benchmarking command

Results are taken after one run. The command used for results is the following:

```sh
node run.mjs
```

`run.mjs` is a script that launches a child process with the app and runs benchmarks against it, recursively, going to the next app in the list.

## Information

### Hardware

Xiaomi Laptop with 16GB RAM and Intel Core i7-8550U processor.

### Software

- **OS**: Manjaro Linux
- **Kernel version**: 5.7.19-2-MANJARO
- **Node.js**: 15.0.1

## Results

> **Note**: benchmarks aren't completely accurate and are different on every run and on every machine. You need to compare proportions instead of absolute values.

The table takes average results.

| framework                  | req/s | transfer/sec | latency  |
| -------------------------- | ----- | ------------ | -------- |
| @tinyhttp/app (w/o exts)   | 14747 | 2.29 MB      | 6.42 ms  |
| @tinyhttp/app (esm)        | 13359 | 2.07 MB      | 6.83 ms  |
| @tinyhttp/app (cjs)        | 11919 | 1.85 MB      | 7.79 ms  |
| express@4.17.1             | 6263  | 965 kB       | 15.33 ms |
| polka@0.5.2                | 19554 | 2.56 MB      | 4.56 ms  |
| koa@2.13 + @koa/router@9.4 | 13443 | 2.31 MB      | 6.83 ms  |

**Conclusion**: tinyhttp (without extra `req` / `res` extensions) is ~2.3x faster than Express and ~1.3x slower than Polka.

## Detailed results

- tinyhttp (without extra `req` / `res` extensions)

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max    │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼────────┤
│ Latency │ 6 ms │ 6 ms │ 10 ms │ 15 ms │ 6.42 ms │ 3.38 ms │ 159 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴────────┘
┌───────────┬────────┬────────┬─────────┬─────────┬──────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼─────────┼────────┤
│ Req/Sec   │ 5471   │ 5471   │ 15663   │ 15959   │ 14747.07 │ 2598.32 │ 5471   │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼─────────┼────────┤
│ Bytes/Sec │ 848 kB │ 848 kB │ 2.43 MB │ 2.47 MB │ 2.29 MB  │ 403 kB  │ 848 kB │
└───────────┴────────┴────────┴─────────┴─────────┴──────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

221k requests in 15.07s, 34.3 MB read
```

- tinyhttp (esm)

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max    │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼────────┤
│ Latency │ 6 ms │ 6 ms │ 11 ms │ 16 ms │ 6.83 ms │ 3.73 ms │ 171 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴────────┘
┌───────────┬────────┬────────┬─────────┬─────────┬──────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼─────────┼────────┤
│ Req/Sec   │ 4587   │ 4587   │ 14103   │ 14559   │ 13359.07 │ 2431.23 │ 4585   │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼─────────┼────────┤
│ Bytes/Sec │ 711 kB │ 711 kB │ 2.19 MB │ 2.26 MB │ 2.07 MB  │ 377 kB  │ 711 kB │
└───────────┴────────┴────────┴─────────┴─────────┴──────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

200k requests in 15.04s, 31.1 MB read
```

- tinyhttp (cjs)

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 6 ms │ 7 ms │ 14 ms │ 17 ms │ 7.79 ms │ 3.15 ms │ 99 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬────────┬────────┬─────────┬─────────┬──────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼─────────┼────────┤
│ Req/Sec   │ 5495   │ 5495   │ 12583   │ 14415   │ 11919.34 │ 2360.83 │ 5494   │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼─────────┼────────┤
│ Bytes/Sec │ 852 kB │ 852 kB │ 1.95 MB │ 2.23 MB │ 1.85 MB  │ 366 kB  │ 852 kB │
└───────────┴────────┴────────┴─────────┴─────────┴──────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

179k requests in 15.04s, 27.7 MB read
```

- express@4.17.1

```
┌─────────┬───────┬───────┬───────┬───────┬──────────┬─────────┬───────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max   │
├─────────┼───────┼───────┼───────┼───────┼──────────┼─────────┼───────┤
│ Latency │ 11 ms │ 14 ms │ 28 ms │ 30 ms │ 15.33 ms │ 4.37 ms │ 75 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴─────────┴───────┘
┌───────────┬────────┬────────┬────────┬─────────┬─────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%    │ 97.5%   │ Avg     │ Stdev   │ Min    │
├───────────┼────────┼────────┼────────┼─────────┼─────────┼─────────┼────────┤
│ Req/Sec   │ 3075   │ 3075   │ 6479   │ 7615    │ 6263.67 │ 1055.91 │ 3074   │
├───────────┼────────┼────────┼────────┼─────────┼─────────┼─────────┼────────┤
│ Bytes/Sec │ 474 kB │ 474 kB │ 998 kB │ 1.17 MB │ 965 kB  │ 163 kB  │ 473 kB │
└───────────┴────────┴────────┴────────┴─────────┴─────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

94k requests in 15.04s, 14.5 MB read
```

- polka@0.5.2

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 3 ms │ 4 ms │ 10 ms │ 12 ms │ 4.56 ms │ 2.62 ms │ 96 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬────────┬────────┬─────────┬─────────┬──────────┬────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg      │ Stdev  │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼────────┼────────┤
│ Req/Sec   │ 7603   │ 7603   │ 19791   │ 25039   │ 19554.27 │ 4419.1 │ 7602   │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼────────┼────────┤
│ Bytes/Sec │ 996 kB │ 996 kB │ 2.59 MB │ 3.28 MB │ 2.56 MB  │ 579 kB │ 996 kB │
└───────────┴────────┴────────┴─────────┴─────────┴──────────┴────────┴────────┘

Req/Bytes counts sampled once per second.

293k requests in 15.05s, 38.4 MB read
```

- koa@2.13 + @koa/router@9.4

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max    │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼────────┤
│ Latency │ 5 ms │ 6 ms │ 13 ms │ 23 ms │ 6.83 ms │ 4.92 ms │ 150 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴────────┘
┌───────────┬────────┬────────┬─────────┬─────────┬──────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼─────────┼────────┤
│ Req/Sec   │ 1845   │ 1845   │ 13911   │ 16399   │ 13443.27 │ 3609.26 │ 1845   │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼─────────┼────────┤
│ Bytes/Sec │ 317 kB │ 317 kB │ 2.39 MB │ 2.82 MB │ 2.31 MB  │ 621 kB  │ 317 kB │
└───────────┴────────┴────────┴─────────┴─────────┴──────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

202k requests in 15.04s, 34.7 MB read
```
