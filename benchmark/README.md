# Benchmarks

## Sample apps

All apps employ two global middlewares with `req` mutations, an empty `GET` route handler for `favicon.ico` and a GET handler for the `/users/:id`, returning a `User: {id}` string response.

## Benchmarking command

Results are taken after one run. The command used for results is the following:

```sh
node run.mjs
```

`run.mjs` is a script that launches a child process with the app and runs benchmarks against it, recursively, going to the next app in the list.

## Information

### Hardware

Xiaomi Laptop with 16GB RAM and Intel Core i7-8550U processor.

### Software

- **OS**: Manjaro Linux
- **Kernel version**: 5.7.19-2-MANJARO
- **Node.js**: 15.0.1

## Results

> **Note**: benchmarks aren't completely accurate and are different on every run and on every machine. You need to compare proportions instead of absolute values.

The table takes average results.

| framework                  | req/s | transfer/sec | latency  |
| -------------------------- | ----- | ------------ | -------- |
| @tinyhttp/app (esm)        | 12827 | 1.99 MB      | 7.25 ms  |
| @tinyhttp/app (cjs)        | 11916 | 1.85 MB      | 7.82 ms  |
| express@4.17.1             | 6013  | 926 kB       | 15.96 ms |
| polka@0.5.2                | 19226 | 2.52 MB      | 4.79 ms  |
| koa@2.13 + @koa/router@9.4 | 12778 | 2.2 MB       | 7.25 ms  |

**Conclusion**: tinyhttp is ~2.1x faster than Express and ~1.5x slower than Polka.

## Detailed results

- tinyhttp (esm)

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max    │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼────────┤
│ Latency │ 6 ms │ 7 ms │ 11 ms │ 17 ms │ 7.25 ms │ 3.87 ms │ 169 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴────────┘
┌───────────┬────────┬────────┬─────────┬─────────┬──────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼─────────┼────────┤
│ Req/Sec   │ 5055   │ 5055   │ 13503   │ 14247   │ 12827.07 │ 2155.14 │ 5052   │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼─────────┼────────┤
│ Bytes/Sec │ 783 kB │ 783 kB │ 2.09 MB │ 2.21 MB │ 1.99 MB  │ 334 kB  │ 783 kB │
└───────────┴────────┴────────┴─────────┴─────────┴──────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

192k requests in 15.07s, 29.8 MB read
```

- tinyhttp (cjs)

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 6 ms │ 7 ms │ 12 ms │ 17 ms │ 7.82 ms │ 2.67 ms │ 85 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬────────┬────────┬─────────┬────────┬──────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%  │ Avg      │ Stdev   │ Min    │
├───────────┼────────┼────────┼─────────┼────────┼──────────┼─────────┼────────┤
│ Req/Sec   │ 6111   │ 6111   │ 12695   │ 14167  │ 11916.14 │ 2115.23 │ 6109   │
├───────────┼────────┼────────┼─────────┼────────┼──────────┼─────────┼────────┤
│ Bytes/Sec │ 947 kB │ 947 kB │ 1.97 MB │ 2.2 MB │ 1.85 MB  │ 328 kB  │ 947 kB │
└───────────┴────────┴────────┴─────────┴────────┴──────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

179k requests in 15.04s, 27.7 MB read
```

- express@4.17.1

```
┌─────────┬───────┬───────┬───────┬───────┬──────────┬─────────┬────────┐
│ Stat    │ 2.5%  │ 50%   │ 97.5% │ 99%   │ Avg      │ Stdev   │ Max    │
├─────────┼───────┼───────┼───────┼───────┼──────────┼─────────┼────────┤
│ Latency │ 11 ms │ 14 ms │ 35 ms │ 48 ms │ 15.96 ms │ 7.03 ms │ 115 ms │
└─────────┴───────┴───────┴───────┴───────┴──────────┴─────────┴────────┘
┌───────────┬────────┬────────┬─────────┬─────────┬─────────┬────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg     │ Stdev  │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼────────┼────────┤
│ Req/Sec   │ 1628   │ 1628   │ 6923    │ 7839    │ 6013.67 │ 1700.8 │ 1628   │
├───────────┼────────┼────────┼─────────┼─────────┼─────────┼────────┼────────┤
│ Bytes/Sec │ 251 kB │ 251 kB │ 1.07 MB │ 1.21 MB │ 926 kB  │ 262 kB │ 251 kB │
└───────────┴────────┴────────┴─────────┴─────────┴─────────┴────────┴────────┘

Req/Bytes counts sampled once per second.

90k requests in 15.05s, 13.9 MB read
```

- polka@0.5.2

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬─────────┬───────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev   │ Max   │
├─────────┼──────┼──────┼───────┼───────┼─────────┼─────────┼───────┤
│ Latency │ 3 ms │ 5 ms │ 8 ms  │ 11 ms │ 4.79 ms │ 2.23 ms │ 99 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴─────────┴───────┘
┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬─────────┬─────────┐
│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min     │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Req/Sec   │ 11391   │ 11391   │ 18559   │ 24335   │ 19226.67 │ 3434.11 │ 11385   │
├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤
│ Bytes/Sec │ 1.49 MB │ 1.49 MB │ 2.43 MB │ 3.19 MB │ 2.52 MB  │ 450 kB  │ 1.49 MB │
└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴─────────┴─────────┘

Req/Bytes counts sampled once per second.

288k requests in 15.03s, 37.8 MB read
```

- koa@2.13 + @koa/router@9.4

```
┌─────────┬──────┬──────┬───────┬───────┬─────────┬────────┬────────┐
│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%   │ Avg     │ Stdev  │ Max    │
├─────────┼──────┼──────┼───────┼───────┼─────────┼────────┼────────┤
│ Latency │ 5 ms │ 7 ms │ 11 ms │ 17 ms │ 7.25 ms │ 3.9 ms │ 174 ms │
└─────────┴──────┴──────┴───────┴───────┴─────────┴────────┴────────┘
┌───────────┬────────┬────────┬─────────┬─────────┬──────────┬─────────┬────────┐
│ Stat      │ 1%     │ 2.5%   │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min    │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼─────────┼────────┤
│ Req/Sec   │ 4215   │ 4215   │ 12631   │ 16623   │ 12778.27 │ 2661.18 │ 4213   │
├───────────┼────────┼────────┼─────────┼─────────┼──────────┼─────────┼────────┤
│ Bytes/Sec │ 725 kB │ 725 kB │ 2.17 MB │ 2.86 MB │ 2.2 MB   │ 458 kB  │ 725 kB │
└───────────┴────────┴────────┴─────────┴─────────┴──────────┴─────────┴────────┘

Req/Bytes counts sampled once per second.

192k requests in 15.03s, 33 MB read
```
